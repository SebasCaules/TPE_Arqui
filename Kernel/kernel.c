#include <stdint.h>
#include <string.h>
#include <lib.h>
#include <moduleLoader.h>
#include <naiveConsole.h>

#include <videoDriver.h>

extern uint8_t text;
extern uint8_t rodata;
extern uint8_t data;
extern uint8_t bss;
extern uint8_t endOfKernelBinary;
extern uint8_t endOfKernel;

static const uint64_t PageSize = 0x1000;

static void * const sampleCodeModuleAddress = (void*)0x400000;
static void * const sampleDataModuleAddress = (void*)0x500000;

#define VIDEO_MEMORY 0xB8000
#define WHITE_ON_GREEN 0xA2  // 0xA2 is white background and green text

typedef int (*EntryPoint)();


void clearBSS(void * bssAddress, uint64_t bssSize)
{
	memset(bssAddress, 0, bssSize);
}

void * getStackBase()
{
	return (void*)(
		(uint64_t)&endOfKernel
		+ PageSize * 8				//The size of the stack itself, 32KiB
		- sizeof(uint64_t)			//Begin at the top of the stack
	);
}

void * initializeKernelBinary()
{
	char buffer[10];

	ncPrint("[x64BareBones]");
	ncNewline();

	ncPrint("CPU Vendor:");
	ncPrint(cpuVendor(buffer));
	ncNewline();

	ncPrint("[Loading modules]");
	ncNewline();
	void * moduleAddresses[] = {
		sampleCodeModuleAddress,
		sampleDataModuleAddress
	};

	loadModules(&endOfKernelBinary, moduleAddresses);
	ncPrint("[Done]");
	ncNewline();
	ncNewline();

	ncPrint("[Initializing kernel's binary]");
	ncNewline();

	clearBSS(&bss, &endOfKernel - &bss);

	ncPrint("  text: 0x");
	ncPrintHex((uint64_t)&text);
	ncNewline();
	ncPrint("  rodata: 0x");
	ncPrintHex((uint64_t)&rodata);
	ncNewline();
	ncPrint("  data: 0x");
	ncPrintHex((uint64_t)&data);
	ncNewline();
	ncPrint("  bss: 0x");
	ncPrintHex((uint64_t)&bss);
	ncNewline();

	ncPrint("[Done]");
	ncNewline();
	ncNewline();
	return getStackBase();
}

uint8_t font_bitmap[94][16] = {
    // ASCII 32: ' ' (space)
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // ASCII 33: '!'
    {0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
    0x18, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00},
    
    // ASCII 34: '"'
    {0x00, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 35: '#'
    {0x00, 0x36, 0x36, 0x7F, 0x7F, 0x36, 0x7F, 0x7F,
    0x36, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // ASCII 36: '$'
    {0x00, 0x18, 0x3E, 0x60, 0x3C, 0x06, 0x3E, 0x18,
    0x18, 0x18, 0x7E, 0x18, 0x00, 0x00, 0x00, 0x00},

    // ASCII 37: '%'
    {0x00, 0x63, 0x63, 0x06, 0x0C, 0x18, 0x30, 0x60,
    0x60, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 38: '&'
    {0x00, 0x3C, 0x66, 0x66, 0x3C, 0x78, 0x6C, 0x66,
    0x66, 0x66, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 39: '''
    {0x00, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 40: '('
    {0x00, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x30, 0x30,
    0x30, 0x30, 0x18, 0x0C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 41: ')'
    {0x00, 0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C,
    0x0C, 0x0C, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00},

    // ASCII 42: '*'
    {0x00, 0x18, 0x7E, 0x3C, 0x66, 0x3C, 0x7E, 0x18,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 43: '+'
    {0x00, 0x18, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x18,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 44: ','
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00},

    // ASCII 45: '-'
    {0x00, 0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 46: '.'
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 47: '/'
    {0x00, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x60, 0x60,
    0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

	// ASCII 48: '0'
    {0x00, 0x3C, 0x66, 0x66, 0x6E, 0x76, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},
     
    // ASCII 49: '1'
    {0x00, 0x18, 0x38, 0x78, 0x18, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00, 0x00},
     
    // ASCII 50: '2'
    {0x00, 0x3C, 0x66, 0x66, 0x06, 0x0C, 0x18, 0x30,
     0x60, 0x60, 0x66, 0x7E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 51: '3'
    {0x00, 0x7E, 0x66, 0x06, 0x06, 0x1C, 0x06, 0x06,
     0x06, 0x06, 0x66, 0x7E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 52: '4'
    {0x00, 0x0C, 0x1C, 0x3C, 0x6C, 0x6C, 0xCC, 0xFE,
     0x0C, 0x0C, 0x0C, 0x0C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 53: '5'
    {0x00, 0x7E, 0x60, 0x60, 0x7C, 0x06, 0x06, 0x06,
     0x06, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 54: '6'
    {0x00, 0x3C, 0x66, 0x66, 0x60, 0x7C, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 55: '7'
    {0x00, 0x7E, 0x66, 0x06, 0x0C, 0x18, 0x18, 0x30,
     0x30, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00},

    // ASCII 56: '8'
    {0x00, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 57: '9'
    {0x00, 0x3C, 0x66, 0x66, 0x66, 0x3E, 0x06, 0x06,
     0x06, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 58: ':'
    {0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00,
     0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 59: ';'
    {0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00,
     0x00, 0x18, 0x18, 0x30, 0x30, 0x00, 0x00, 0x00},

    // ASCII 60: '<'
    {0x00, 0x00, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30,
     0x30, 0x18, 0x0C, 0x06, 0x00, 0x00, 0x00, 0x00},

    // ASCII 61: '='
    {0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00,
     0x7E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 62: '>'
    {0x00, 0x00, 0x60, 0x30, 0x18, 0x0C, 0x0C, 0x0C,
     0x0C, 0x18, 0x30, 0x60, 0x00, 0x00, 0x00, 0x00},

    // ASCII 63: '?'
    {0x00, 0x3C, 0x66, 0x66, 0x06, 0x0C, 0x18, 0x18,
     0x18, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00},
	 // ASCII 64: '@'
    {0x00, 0x3C, 0x42, 0x5A, 0x5A, 0x5A, 0x5A, 0x5C,
     0x40, 0x40, 0x42, 0x3C, 0x00, 0x00, 0x00, 0x00},
     
    // ASCII 65: 'A'
    {0x00, 0x18, 0x24, 0x42, 0x42, 0x42, 0x7E, 0x42,
     0x42, 0x42, 0x42, 0x42, 0x00, 0x00, 0x00, 0x00},
     
    // ASCII 66: 'B'
    {0x00, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x7C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 67: 'C'
    {0x00, 0x3C, 0x66, 0x66, 0x60, 0x60, 0x60, 0x60,
     0x60, 0x60, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00},

    // ASCII 68: 'D'
    {0x00, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x7C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 69: 'E'
    {0x00, 0x7E, 0x60, 0x60, 0x60, 0x7C, 0x60, 0x60,
     0x60, 0x60, 0x60, 0x7E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 70: 'F'
    {0x00, 0x7E, 0x60, 0x60, 0x60, 0x7C, 0x60, 0x60,
     0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00, 0x00},

    // ASCII 71: 'G'
    {0x00, 0x3C, 0x66, 0x60, 0x60, 0x60, 0x6E, 0x66,
     0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 72: 'H'
    {0x00, 0x66, 0x66, 0x66, 0x66, 0x7E, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},

    // ASCII 73: 'I'
    {0x00, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 74: 'J'
    {0x00, 0x7E, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06,
     0x06, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 75: 'K'
    {0x00, 0x66, 0x66, 0x6C, 0x6C, 0x78, 0x78, 0x78,
     0x6C, 0x6C, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},

    // ASCII 76: 'L'
    {0x00, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60,
     0x60, 0x60, 0x60, 0x7E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 77: 'M'
    {0x00, 0x66, 0x66, 0x7E, 0x7E, 0x7E, 0x7E, 0x66,
     0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},

    // ASCII 78: 'N'
    {0x00, 0x66, 0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x6E,
     0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},

    // ASCII 79: 'O'
    {0x00, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

	// ASCII 80: 'P'
    {0x00, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x60,
     0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00, 0x00},
     
    // ASCII 81: 'Q'
    {0x00, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x76, 0x3E, 0x00, 0x06, 0x06, 0x00},
     
    // ASCII 82: 'R'
    {0x00, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x6C,
     0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},

    // ASCII 83: 'S'
    {0x00, 0x3E, 0x60, 0x60, 0x60, 0x3C, 0x06, 0x06,
     0x06, 0x06, 0x06, 0x7C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 84: 'T'
    {0x00, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00},

    // ASCII 85: 'U'
    {0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 86: 'V'
    {0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3C, 0x18, 0x00, 0x00, 0x00, 0x00},

    // ASCII 87: 'W'
    {0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x7E, 0x7E,
     0x7E, 0x7E, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},

    // ASCII 88: 'X'
    {0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x3C,
     0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},

    // ASCII 89: 'Y'
    {0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18,
     0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00},

    // ASCII 90: 'Z'
    {0x00, 0x7E, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x60,
     0x60, 0x7E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

	 // ASCII 91: '['
    {0x00, 0x3E, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
     0x30, 0x30, 0x30, 0x3E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 92: '\'
    {0x00, 0x60, 0x60, 0x30, 0x30, 0x30, 0x18, 0x18,
     0x18, 0x0C, 0x0C, 0x06, 0x06, 0x00, 0x00, 0x00},

    // ASCII 93: ']'
    {0x00, 0x3E, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06,
     0x06, 0x06, 0x06, 0x3E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 94: '^'
    {0x00, 0x18, 0x3C, 0x66, 0x66, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 95: '_'
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00},

	 // ASCII 96: '`'
    {0x00, 0x30, 0x18, 0x0C, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
     
    // ASCII 97: 'a'
    {0x00, 0x00, 0x00, 0x00, 0x3C, 0x06, 0x3E, 0x66,
     0x66, 0x66, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00},
     
    // ASCII 98: 'b'
    {0x00, 0x60, 0x60, 0x60, 0x7C, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 99: 'c'
    {0x00, 0x00, 0x00, 0x00, 0x3C, 0x66, 0x60, 0x60,
     0x60, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 100: 'd'
    {0x00, 0x06, 0x06, 0x06, 0x3E, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 101: 'e'
    {0x00, 0x00, 0x00, 0x00, 0x3C, 0x66, 0x7E, 0x60,
     0x60, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 102: 'f'
    {0x00, 0x0E, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 103: 'g'
    {0x00, 0x00, 0x00, 0x00, 0x3E, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3E, 0x06, 0x3C, 0x00, 0x00, 0x00},

    // ASCII 104: 'h'
    {0x00, 0x60, 0x60, 0x60, 0x7C, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 105: 'i'
    {0x00, 0x18, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 106: 'j'
    {0x00, 0x06, 0x00, 0x06, 0x06, 0x06, 0x06, 0x06,
     0x06, 0x06, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00},

    // ASCII 107: 'k'
    {0x00, 0x60, 0x60, 0x60, 0x66, 0x6C, 0x78, 0x78,
     0x6C, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 108: 'l'
    {0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00, 0x00},

    // ASCII 109: 'm'
    {0x00, 0x00, 0x00, 0x00, 0x7E, 0x7E, 0x7E, 0x7E,
     0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 110: 'n'
    {0x00, 0x00, 0x00, 0x00, 0x7C, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 111: 'o'
    {0x00, 0x00, 0x00, 0x00, 0x3C, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00},

	 // ASCII 112: 'p'
    {0x00, 0x00, 0x00, 0x00, 0x7C, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00, 0x00},
     
    // ASCII 113: 'q'
    {0x00, 0x00, 0x00, 0x00, 0x3E, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3E, 0x06, 0x06, 0x06, 0x00, 0x00},
     
    // ASCII 114: 'r'
    {0x00, 0x00, 0x00, 0x00, 0x6E, 0x38, 0x30, 0x30,
     0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 115: 's'
    {0x00, 0x00, 0x00, 0x00, 0x3E, 0x60, 0x60, 0x3C,
     0x06, 0x06, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 116: 't'
    {0x00, 0x18, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 117: 'u'
    {0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 118: 'v'
    {0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3C, 0x18, 0x00, 0x00, 0x00, 0x00},

    // ASCII 119: 'w'
    {0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0x66, 0x7E,
     0x7E, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 120: 'x'
    {0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0x3C, 0x18,
     0x3C, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 121: 'y'
    {0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0x66, 0x66,
     0x66, 0x66, 0x3E, 0x06, 0x7C, 0x00, 0x00, 0x00},

    // ASCII 122: 'z'
    {0x00, 0x00, 0x00, 0x00, 0x7E, 0x06, 0x0C, 0x18,
     0x30, 0x60, 0x7E, 0x00, 0x00, 0x00, 0x00, 0x00},

    // ASCII 123: '{'
    {0x00, 0x0C, 0x18, 0x18, 0x18, 0x30, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x0C, 0x00, 0x00, 0x00, 0x00},

    // ASCII 124: '|'
    {0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00},

    // ASCII 125: '}'
    {0x00, 0x30, 0x18, 0x18, 0x18, 0x0C, 0x18, 0x18,
     0x18, 0x18, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00},

    // ASCII 126: '~'
    {0x00, 0x00, 0x00, 0x32, 0x4C, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}

};

void drawchar(unsigned char c, int x, int y, int fgcolor, int bgcolor)
{
	int cx,cy;
	int mask[8]={128,64,32,16,8,4,2,1};
	unsigned char *glyph=font_bitmap[c-32];

	for(cy=0;cy<16;cy++){
		for(cx=0;cx<8;cx++){
			putPixel(glyph[cy]&mask[cx]?fgcolor:bgcolor,x+cx,y+cy-12);
		}
	}
}

void printStr(char* str, int x, int y, int fgcolor, int bgcolor){
    for (size_t i = 0; str[i]; i++) {
        drawchar(str[i], x + i * 8, y, fgcolor, bgcolor);
    }
}

void reverseStr(char *str, int length) {
    int start = 0;
    int end = length - 1;
    while (start < end) {
        char temp = str[start];
        str[start] = str[end];
        str[end] = temp;
        start++;
        end--;
    }
}

void intToStr(int num, char *str) {
    int i = 0;
    int isNegative = 0;

    // Handle negative numbers
    if (num < 0) {
        isNegative = 1;
        num = -num;
    }

    // Convert each digit of the number to a character
    do {
        str[i++] = (num % 10) + '0';
        num /= 10;
    } while (num > 0);

    // Add negative sign if necessary
    if (isNegative) {
        str[i++] = '-';
    }

    // Null-terminate the string
    str[i] = '\0';

    // Reverse the string
    reverseStr(str, i);
}


int main() {
	putPixel(0x00FF0000, 20, 20); //Imprime un pixel rojo

    int posX = 50;
    int posY = 50;
    uint32_t foregroundColor = 0x00FFFFFF; // White color in RGB
    uint32_t backgroundColor = 0x00000000; // Black color in RGB

    char widthStr[10];
    intToStr(getWidth(), widthStr);
    printStr(widthStr, posX, posY, foregroundColor, backgroundColor);
    // Width = 1024

    char heightStr[10];
    intToStr(getHeight(), heightStr);
    printStr(heightStr, posX, posY + 20, foregroundColor, backgroundColor);
    // Height = 768

	return 0;
}


